define("metaserver/static/js/edison/ui/spa_product_name",["require","exports","@dropbox/ttvc","metaserver/static/js/core/exception"],(function(e,t,r,n){"use strict";let s;Object.defineProperty(t,"__esModule",{value:!0}),t.setSpaProductName=t.getSpaProductName=t.startNavigation=void 0;t.startNavigation=function(){s=void 0,(0,r.start)()};t.getSpaProductName=()=>s;t.setSpaProductName=e=>{void 0!==s?(0,n.reportStack)(`setSpaProductName: SPA_PRODUCT_NAME already set! Tried to set product to "${e}", but was already set to "${s}"`,{severity:n.SEVERITY.NONCRITICAL,tags:["user_centric_perf"]}):s=e}})),define("metaserver/static/js/pap/analytics_client",["require","exports","tslib","metaserver/static/js/clean/viewer","metaserver/static/js/clean/active_user","metaserver/static/js/modules/constants/auth","metaserver/static/js/api_v2/noauth_client","metaserver/static/js/api_v2/transport/beacon","js/pap-client/index","js/pap-events/experimentation/exposure_stormcrow"],(function(e,t,r,n,s,i,o,a,c,d){"use strict";let u;function l(){return u||(u=new c.AnalyticsClient({transport:{type:c.TRANSPORT_TYPE.apiv2,apiV2Client:new o.NoAuthApiV2Client},sendBeaconTransport:{type:c.TRANSPORT_TYPE.apiv2,apiV2Client:new o.NoAuthApiV2Client(new a.BeaconTransport)}})),u}function p(){const e=l().getPersistentFields(),t=(function(){var e,t;const r=n.Viewer.get_viewer(),o=null!==(e=(0,s.getActiveUserId)())&&void 0!==e?e:i.user_id,a=null==r?void 0:r.team_id,c=null===(t=null==r?void 0:r.get_users().find(({id:e})=>e!==o))||void 0===t?void 0:t.id;return Object.assign(Object.assign(Object.assign({},o&&{userId:o}),a&&{teamId:a}),c&&{pairedUserId:c})})(),r=[t,e.identity||{}].some(e=>Object.keys(e).length);l().setPersistentFields(Object.assign(Object.assign({},e),!!r&&{identity:Object.assign(Object.assign({},t),e.identity)}))}function v(e,t={},r="core_dropbox",n=!1){p(),l().logEvent(e,t,r,n)}Object.defineProperty(t,"__esModule",{value:!0}),t.updateConfigs=t.logExposureEvent=t.setPersistentFields=t.logEvent=t.getAnalyticsClientSingleton=void 0,i=r.__importStar(i),t.getAnalyticsClientSingleton=l,t.logEvent=v,t.setPersistentFields=function(e){l().setPersistentFields(e)},t.logExposureEvent=function(e,t,r,n,s){const i={experiment_variant:t,feature:e,population_id:r,identity_gid:n,stormcrow_metadata_json:s,".tag":"stormcrow_exposure_event"},o=(0,d.PAP_Exposure_Stormcrow)({feature:e,experimentVariant:t,populationId:r,identityGid:n,stormcrowMetadataJson:s});try{v(o)}catch(e){v(i)}},t.updateConfigs=function(e){l().updateConfigs(e)}})),define("js/pap-events/experimentation/exposure_stormcrow",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAP_Exposure_Stormcrow=void 0,t.PAP_Exposure_Stormcrow=function(e){return{class:"experimentation",action:"exposure",object:"stormcrow",properties:e}}})),define("js/pap-client/util",["require","exports"],(function(e,t){"use strict";function r(e){return e.trim().replace(/\W+/g,"_").replace(/([a-z])([A-Z])/g,"$1_$2").replace(/^_+|_+$/g,"").toLowerCase()}Object.defineProperty(t,"__esModule",{value:!0}),t._generateCallerID=t.getTagFromErrorMessage=t.getEnumValueForString=t.convertCamelToSnakeCase=t.snakeCase=void 0,t.snakeCase=r,t.convertCamelToSnakeCase=function(e){return e.replace(/[A-Z]/g,(e,t)=>0===t?e.toLowerCase():"_"+e.toLowerCase())},t.getEnumValueForString=function(e,t){var n;return t[null===(n=r(e))||void 0===n?void 0:n.toUpperCase()]},t.getTagFromErrorMessage=function(e,t=25){let r="";const n=e.toLowerCase().split(/\s+/).join("-");for(const e of n){if(r.length>=t)break;const n=e.charCodeAt(0);n>47&&n<58||n>96&&n<123?r+=e:45===n&&"-"!==r[r.length-1]&&(r+=e)}return"-"===r[r.length-1]&&(r=r.slice(0,r.length-1)),r},t._generateCallerID=function(){const e=/([^(]+)@|at ([^(]+) \(/,t=new Error;if(void 0===t.stack)return"unknown";let r="";return t.stack.split("\n").slice(3,7).forEach(t=>{const n=e.exec(t);r+="/"+(null===n?"?":(n[1]||n[2]).replace("<anonymous>","?"))}),r.substring(0,64)}})),define("js/pap-client/transport",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TRANSPORT_TYPE=void 0,t.TRANSPORT_TYPE={apiv2:"apiv2",fetch:"fetch",sdk:"sdk"}})),define("js/pap-client/serialize",["require","exports","js/pap-client/event","js/pap-client/exceptions","js/uuid/uuid"],(function(e,t,r,n,s){"use strict";function i(e){const{identity:t}=e;return(null==t?void 0:t.foreignUserProvider)&&(null==t?void 0:t.foreignUserId)?{foreign_user_provider:null==t?void 0:t.foreignUserProvider,foreign_user_id:null==t?void 0:t.foreignUserId,user_id:void 0,team_id:void 0,paired_user_id:void 0}:(null==t?void 0:t.foreignUserProvider)&&!(null==t?void 0:t.foreignUserId)||!(null==t?void 0:t.foreignUserProvider)&&(null==t?void 0:t.foreignUserId)?((null==t?void 0:t.foreignUserId)?(null==t?void 0:t.foreignUserProvider)||(0,n.reportStack)("Missing foreign_user_provider"):(0,n.reportStack)("Missing foreign_user_id"),{foreign_user_provider:null==t?void 0:t.foreignUserProvider,foreign_user_id:null==t?void 0:t.foreignUserId,user_id:null==t?void 0:t.userId,team_id:null==t?void 0:t.teamId,paired_user_id:null==t?void 0:t.pairedUserId}):{user_id:null==t?void 0:t.userId,team_id:null==t?void 0:t.teamId,paired_user_id:null==t?void 0:t.pairedUserId}}Object.defineProperty(t,"__esModule",{value:!0}),t.createPAPEventEntries=void 0,t.createPAPEventEntries=function(e,t,n,o){var a,c,d,u,l;return{application_fields:{build_channel:{".tag":"stable"},product_name:{".tag":t.application.productName}},device_fields:{locale:navigator.languages&&navigator.languages.length>0?navigator.languages[0]:navigator.language,platform_fields:{".tag":"client_web_device_fields",ua_browser_lang:null===(a=null==o?void 0:o.navigator)||void 0===a?void 0:a.language,is_br_cookies_enabled:null===(c=null==o?void 0:o.navigator)||void 0===c?void 0:c.cookieEnabled,ua_br_color_depth:null===(d=null==o?void 0:o.screen)||void 0===d?void 0:d.colorDepth,ua_br_viewport_width:null==o?void 0:o.innerWidth,ua_br_viewport_height:null==o?void 0:o.innerHeight,device_screen_height:null===(u=null==o?void 0:o.screen)||void 0===u?void 0:u.height,device_screen_width:null===(l=null==o?void 0:o.screen)||void 0===l?void 0:l.width,url:null==o?void 0:o.location.href,referrer:null===document||void 0===document?void 0:document.referrer,request_id:n.requestId}},client_identity_fields:i(t),events:e.map(({payload:e,ts:t,sessionId:n})=>(function(e,t,n){return(0,r.isStormcrowExposureEvent)(e)?{event_identifier:e,event_ts:new Date(t).toISOString(),platform_session_id:n,event_guid:s.UUID.v4()}:{event_identifier:{event_action:(0,r.getEventAction)(e),event_object:(0,r.getEventObject)(e),".tag":"predefined_event"},event_properties:(0,r.getEventProperties)(e),event_ts:new Date(t).toISOString(),action_surface:(0,r.getEventActionSurface)(e),event_class:(0,r.getEventClass)(e),event_state:{".tag":(0,r.getEventState)(e)},platform_session_id:n,event_guid:s.UUID.v4()}})(e,t,n))}}})),define("js/pap-client/metrics_reporter",["require","exports","tslib","js/pap-client/transport","typescript/libraries/shared/apex-metrics/src/index","typescript/libraries/shared/apex-metrics/src/sink/index"],(function(e,t,r,n,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WEB_PAP_AMP_NS=void 0,t.WEB_PAP_AMP_NS="web_product_analytics_pipeline";t.default=class{constructor(e){this.metricsReporter=(0,i.getMetricsReporter)({clientFactory:()=>r.__awaiter(this,void 0,void 0,(function*(){return(e=>{switch(e.type){case n.TRANSPORT_TYPE.fetch:return(0,i.clientFetchAdaptor)(e.fetch);case n.TRANSPORT_TYPE.apiv2:return(0,i.clientBaseAdaptor)(e.apiV2Client);case n.TRANSPORT_TYPE.sdk:return(0,i.clientSDKAdaptor)(e.sdk)}})(e.transport)})),originKind:"pap-client"}),this.counterEventsSent=this.metricsReporter.createCounter({ns:t.WEB_PAP_AMP_NS,name:"pap/web/events/sent"}),this.counterRequestsEvents=this.metricsReporter.createCounter({ns:t.WEB_PAP_AMP_NS,name:"pap/web/requests/events"}),this.counterRequestsSuccess=this.metricsReporter.createCounter({ns:t.WEB_PAP_AMP_NS,name:"pap/web/requests/success"}),this.counterRequestsAttempts=this.metricsReporter.createCounter({ns:t.WEB_PAP_AMP_NS,name:"pap/web/requests/attempts"}),this.statsQueueSize=this.metricsReporter.createStats({ns:t.WEB_PAP_AMP_NS,name:"pap/web/events/queued"})}recordEventsDropped(e,r){const n=this.metricsReporter.createCounter({ns:t.WEB_PAP_AMP_NS,name:"pap/web/events/dropped"},r);n.increment(e),n.record()}recordEventsSent(e){this.counterEventsSent.increment(e),this.counterEventsSent.record()}recordRequestsEvents(e){this.counterRequestsEvents.increment(e),this.counterRequestsEvents.record()}recordRequestsSuccess(e){this.counterRequestsSuccess.increment(e),this.counterRequestsSuccess.record()}recordRequestsAttempts(e){this.counterRequestsAttempts.increment(e),this.counterRequestsAttempts.record()}recordRequestsFailed(e,r){const n=this.metricsReporter.createCounter({ns:t.WEB_PAP_AMP_NS,name:"pap/web/requests/failure"},r);n.increment(e),n.record()}recordQueueSize(e){this.statsQueueSize.record(e)}createSendEventsTimer(e){return this.metricsReporter.createTimer({ns:t.WEB_PAP_AMP_NS,name:"analytics-client-logger/events/send-timer"},e)}recordEventStats(e,r,n){const s=this.metricsReporter.createCounter({ns:t.WEB_PAP_AMP_NS,name:"analytics-client-event/"+r+"/"+e},n);s.increment(1),s.record()}recordPerformance(e){const r={latency:this.metricsReporter.createStats({ns:t.WEB_PAP_AMP_NS,name:"pap/web/requests/latency"}),transferSize:this.metricsReporter.createStats({ns:t.WEB_PAP_AMP_NS,name:"pap/web/requests/transfer_size"}),encodedBodySize:this.metricsReporter.createStats({ns:t.WEB_PAP_AMP_NS,name:"pap/web/requests/encoded_body_size"})};r.latency.recordDuration(e.duration,s.TimeUnit.MILLISECONDS),r.transferSize.record(e.transferSize),r.encodedBodySize.record(e.encodedBodySize)}recordPermanentlyFailedEvent(){const e=this.metricsReporter.createCounter({ns:t.WEB_PAP_AMP_NS,name:"pap/web/events/permanently_failed"});e.increment(1),e.record()}}})),define("js/pap-client/logger",["require","exports","tslib","js/pap-client/api","js/pap-client/event","js/pap-client/exceptions","js/pap-client/serialize","js/pap-client/util"],(function(e,t,r,n,s,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=t.EventQueue=t.MAX_EVENT_QUEUE_SIZE=t.MAX_EVENTS_PER_REQUEST=t.MAX_SEND_ATTEMPTS=t.DEFAULT_FLUSH_INTERVAL=t.MIN_FLUSH_INTERVAL=t.TIME_BEFORE_FIRST_FLUSH=void 0,n=r.__importStar(n),t.TIME_BEFORE_FIRST_FLUSH=5e3,t.MIN_FLUSH_INTERVAL=2e3,t.DEFAULT_FLUSH_INTERVAL=3e4,t.MAX_SEND_ATTEMPTS=4,t.MAX_EVENTS_PER_REQUEST=2e3,t.MAX_EVENT_QUEUE_SIZE=2e4;class c{constructor(e){this.events=[],this.metricsReporter=e.metricsReporter,this.configMaxSize=(null==e?void 0:e.maxSize)||t.MAX_EVENT_QUEUE_SIZE}dropEvents(e,t){const r=this.popEvents(e);r.forEach(e=>{void 0!==e&&e.options.onFailedToSendEvent&&e.options.onFailedToSendEvent(!1)}),this.metricsReporter.recordEventsDropped(r.length,{reason:null!=t?t:"unknown_reason"})}popEvents(e){return this.events.splice(0,e)}add(e){this.isFull()&&this.dropEvents(this.events.length-this.configMaxSize+1,"queue_full"),this.events.push(e)}requeue(e){this.events.unshift(...e),this.isFull()&&this.dropEvents(this.events.length-this.configMaxSize,"queue_full")}size(){return this.events.length}isEmpty(){return 0===this.events.length}isFull(){return this.events.length>=this.configMaxSize}}t.EventQueue=c;t.Logger=class{constructor(e){this.eventQueueByPersistentFields={},this.configs={},this.transport=e.transport,this.sendBeaconTransport=e.sendBeaconTransport,this.configMaxEventsPerRequest=e.maxEventsPerRequest||t.MAX_EVENTS_PER_REQUEST,this.metricsReporter=e.metricsReporter,this.populateWindowPropertiesCache(),this.start()}populateWindowPropertiesCache(){this.windowPropertiesCache={navigator:{language:window.navigator.language,cookieEnabled:window.navigator.cookieEnabled},screen:{height:window.screen.height,width:window.screen.width,colorDepth:window.screen.colorDepth},location:{href:window.location.href},innerWidth:window.innerWidth,innerHeight:window.innerHeight}}start(){document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&this.flush(!0)}),window.addEventListener("pagehide",()=>{this.flush(!0)}),this.scheduleFlush(t.TIME_BEFORE_FIRST_FLUSH)}add(e,t,r){this.populateWindowPropertiesCache(),(0,s.hasValidEventName)(e)||(0,i.reportStack)(`Invalid event name ${(0,s.getEventName)(e)}`);let n=this.eventQueueByPersistentFields[JSON.stringify(r)];void 0===n&&(n=new c({metricsReporter:this.metricsReporter}),this.eventQueueByPersistentFields[JSON.stringify(r)]=n),n.add({payload:e,ts:Date.now(),sendAttempts:0,sessionId:this.getSessionId(),options:t}),t.flush&&this.flush(),this.metricsReporter.recordQueueSize(n.size())}scheduleFlush(e){this.timeoutId=setTimeout(()=>this.flush(),e)}flush(e){var s;return r.__awaiter(this,void 0,void 0,(function*(){this.timeoutId&&clearTimeout(this.timeoutId);let r=t.DEFAULT_FLUSH_INTERVAL;for(const[c,d]of Object.entries(this.eventQueueByPersistentFields)){if(void 0===d||d.isEmpty())continue;const u=d.popEvents(this.configMaxEventsPerRequest);let l=!1;u.forEach(e=>e.sendAttempts++);try{const t=(0,o.createPAPEventEntries)(u,JSON.parse(c),this.configs,this.windowPropertiesCache),r=this.metricsReporter.createSendEventsTimer({beacon:Boolean(e).toString()});yield n.addEvents(t,e&&this.sendBeaconTransport?this.sendBeaconTransport:this.transport),r.record(),l=!0}catch(e){(0,i.reportException)({err:e}),this.metricsReporter.recordRequestsFailed(1,{error_name:(null!==(s=null==e?void 0:e.name)&&void 0!==s?s:null==e?void 0:e.message)?(0,a.getTagFromErrorMessage)(e.message):"unknown_error"})}if(this.metricsReporter.recordRequestsEvents(u.length),l)this.metricsReporter.recordRequestsSuccess(1),this.metricsReporter.recordRequestsAttempts(Math.max(...u.map(e=>e.sendAttempts))),this.metricsReporter.recordEventsSent(u.length),d.isEmpty()||(r=t.MIN_FLUSH_INTERVAL);else{const e=u.filter(e=>(e.options.onFailedToSendEvent&&e.options.onFailedToSendEvent(e.sendAttempts<t.MAX_SEND_ATTEMPTS),e.sendAttempts<t.MAX_SEND_ATTEMPTS));e.length>0&&d.requeue(e);const r=u.length-e.length;r>0&&(this.metricsReporter.recordRequestsAttempts(Math.max(...u.map(e=>e.sendAttempts))),this.metricsReporter.recordEventsDropped(r,{reason:"hit_max_retries"}))}}this.scheduleFlush(Math.floor(r*(.8+.4*Math.random())))}))}getSessionId(){let e;try{e=window.localStorage}catch(e){return Date.now().toString()}if(!e)return Date.now().toString();const t=e.getItem("pap_session_last_used");let r=e.getItem("pap_session_value");return(!r||!t||parseInt(t,10)<Date.now()-18e5)&&(r=Date.now().toString(),e.setItem("pap_session_value",r)),e.setItem("pap_session_last_used",Date.now().toString()),r}updateConfigs(e){this.configs=Object.assign(Object.assign({},this.configs),e)}}})),define("js/pap-client/index",["require","exports","js/pap-client/analytics_client","js/pap-client/transport"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnalyticsClient=t.TRANSPORT_TYPE=void 0,Object.defineProperty(t,"AnalyticsClient",{enumerable:!0,get:function(){return r.AnalyticsClient}}),Object.defineProperty(t,"TRANSPORT_TYPE",{enumerable:!0,get:function(){return n.TRANSPORT_TYPE}})})),define("js/pap-client/exceptions",["require","exports"],(function(e,t){"use strict";function reportException(e){const{err:t}=e;t.tags=[...(null==t?void 0:t.tags)||[],...(null==e?void 0:e.tags)||["pap_web"]],t.severity=e.severity,t.force=e.force,"undefined"==typeof jest&&setTimeout(()=>{throw t},0)}Object.defineProperty(t,"__esModule",{value:!0}),t.reportException=t.reportStack=t.SEVERITY=void 0,t.SEVERITY={CRITICAL:"critical",NONCRITICAL:"non-critical",USER_ERROR:"user-error",UNCAUGHT:"uncaught",OPERATIONAL:"operational"},t.reportStack=function(e,r){const n=new Error(e),s={force:!0,severity:(null==r?void 0:r.severity)||t.SEVERITY.NONCRITICAL,tags:(null==r?void 0:r.tags)||["pap_web"]};reportException(Object.assign({err:n},s))},t.reportException=reportException})),define("js/pap-client/event",["require","exports","js/pap-client/util"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEventProperties=t.hasValidEventName=t.isStormcrowExposureEvent=t.getEventState=t.getEventActionSurface=t.getEventObject=t.getEventAction=t.getEventName=t.getEventClass=void 0;const n=["actionSurface","eventClass","eventState"];function s(e){if("class"in e&&"action"in e&&"object"in e)return e}function i(e){var t;const n=s(e);if(n)return n.action;try{const n=null===(t=e.constructor)||void 0===t?void 0:t.getTypeUrl().split(".").pop();return(0,r.convertCamelToSnakeCase)(null==n?void 0:n.split("_")[0])}catch(e){}}function o(e){var t;const n=s(e);if(n)return n.object;try{const n=null===(t=e.constructor)||void 0===t?void 0:t.getTypeUrl().split(".").pop();return(0,r.convertCamelToSnakeCase)(null==n?void 0:n.split("_")[1])}catch(e){}}function a(e){return".tag"in e&&"stormcrow_exposure_event"===e[".tag"]}function c(e,t,r){var n;if(!t||!t.length)return;const s=t.charAt(0).toUpperCase()+t.substring(1),i=(null===(n=e.constructor)||void 0===n?void 0:n[s])||{},o=e[t]||r;for(const e of Object.keys(i))if(parseInt(i[e],10)===o)return e.toLowerCase()}t.getEventClass=function(e){const t=s(e);return t?t.class:c(e,"eventClass",0)},t.getEventName=function(e){const t=i(e),r=o(e);if(void 0!==t&&void 0!==r)return t+"."+r},t.getEventAction=i,t.getEventObject=o,t.getEventActionSurface=function(e){var t;const r=s(e);return r?null===(t=r.properties)||void 0===t?void 0:t.actionSurface:null==e?void 0:e.actionSurface},t.getEventState=function(e){var t,r;return(null===(r=null===(t=s(e))||void 0===t?void 0:t.properties)||void 0===r?void 0:r.eventState)||"unknown_event_state"},t.isStormcrowExposureEvent=a,t.hasValidEventName=function(e){return!!a(e)||void 0!==i(e)&&void 0!==o(e)},t.getEventProperties=function(e){const t={},i=s(e);if(i)for(const e in i.properties)-1===n.indexOf(e)&&i.properties.hasOwnProperty(e)&&void 0!==i.properties[e]&&(t[(0,r.convertCamelToSnakeCase)(e)]=i.properties[e].toString());else for(const s in e)if(-1===n.indexOf(s)&&e.hasOwnProperty(s)){const n=c(e,s);t[(0,r.convertCamelToSnakeCase)(s)]=n||e[s].toString()}return t}})),define("js/pap-client/api",["require","exports","tslib","js/pap-client/transport"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addEvents=t.LOG_EVENTS_ENDPOINT=t.PAP_EVENT_LOGGING_NAMESPACE=void 0,t.PAP_EVENT_LOGGING_NAMESPACE="pap_event_logging",t.LOG_EVENTS_ENDPOINT="log_events",t.addEvents=function(e,s){return r.__awaiter(this,void 0,void 0,(function*(){switch(s.type){case n.TRANSPORT_TYPE.fetch:return s.fetch(`/2/${t.PAP_EVENT_LOGGING_NAMESPACE}/${t.LOG_EVENTS_ENDPOINT}`,{method:"POST",body:JSON.stringify({event_entries:e}),headers:{"Content-Type":"application/json"}});case n.TRANSPORT_TYPE.apiv2:return s.apiV2Client.ns(t.PAP_EVENT_LOGGING_NAMESPACE).rpc(t.LOG_EVENTS_ENDPOINT,{event_entries:e},{});case n.TRANSPORT_TYPE.sdk:return s.sdk.papEventLoggingLogEvents({event_entries:e})}}))}})),define("js/pap-client/analytics_client",["require","exports","tslib","js/pap-client/event","js/pap-client/exceptions","js/pap-client/logger","js/pap-client/metrics_reporter","js/pap-client/util"],(function(e,t,r,n,s,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnalyticsClient=void 0,o=r.__importDefault(o);const c={application:{productName:"core_dropbox"}};t.AnalyticsClient=class{constructor(e){if(this.resetPersistentFields=()=>this.persistentFields=c,this.getPersistentFields=()=>this.persistentFields,this.setPersistentFields=e=>{var t;this.persistentFields=Object.assign(Object.assign(Object.assign({},this.persistentFields),{application:Object.assign(Object.assign({},this.persistentFields.application),e.application)}),(this.persistentFields.identity||e.identity)&&{identity:Object.assign(Object.assign({},this.persistentFields.identity),null!==(t=e.identity)&&void 0!==t?t:{})})},this.observerCallback=e=>{try{const t=e.getEntriesByName("https://www.dropbox.com/2/pap_event_logging/log_events","resource");for(const e of t)this.metricsReporter.recordPerformance(e)}catch(e){(0,s.reportException)({err:e,tags:["web_analytics_client"]})}},this.metricsReporter=new o.default({transport:e.transport}),this.logger=new i.Logger({transport:e.transport,sendBeaconTransport:e.sendBeaconTransport,metricsReporter:this.metricsReporter}),this.persistentFields=c,window&&window.PerformanceObserver)try{new window.PerformanceObserver(this.observerCallback).observe({entryTypes:["resource"]})}catch(e){(0,s.reportException)({err:e,tags:["web_analytics_client"]})}}updateConfigs(e){this.logger.updateConfigs(e)}logExposureEvent(e,t,r,n,s){const i={experiment_variant:t,feature:e,population_id:r,identity_gid:n,stormcrow_metadata_json:s,".tag":"stormcrow_exposure_event"};this.logEvent(i)}logEvent(e,t={},r,s=!1){var i,o;if(!(0,n.isStormcrowExposureEvent)(e)){const t=s?{caller:(0,a._generateCallerID)()}:{};this.metricsReporter.recordEventStats((0,n.getEventName)(e),"pap",t)}const c=r||(null===(o=null===(i=this.persistentFields)||void 0===i?void 0:i.application)||void 0===o?void 0:o.productName)||"core_dropbox";this.logger.add(e,Object.assign(Object.assign({},t),{onFailedToSendEvent:e=>{e||this.metricsReporter.recordPermanentlyFailedEvent(),t.onFailedToSendEvent&&t.onFailedToSendEvent(e)}}),Object.assign(Object.assign({},this.persistentFields),{application:{productName:c}}))}}})),define("metaserver/static/js/api_v2/transport/beacon",["require","exports","tslib","metaserver/static/js/api_v2/types","metaserver/static/js/api_v2/transport/fetch","sjcl"],(function(e,t,r,n,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BeaconTransport=void 0,i=r.__importStar(i);t.BeaconTransport=class{executeRpc(e,t,r,o){var a;const c=null===(a=navigator.sendBeacon)||void 0===a?void 0:a.bind(navigator);if(c)return new Promise((function(s,a){var d;const u=(function(e,t){const r=i.codec.utf8String.toBits(e),n=new i.misc.hmac(r,i.hash.sha256).encrypt(t);return i.codec.base64url.fromBits(n)})(null!==(d=t[n.ApiV2HeaderNames.CsrfToken])&&void 0!==d?d:"",e.getPath());e.updateQuery({t:u});const l=new Blob([r,JSON.stringify(Object.assign(Object.assign({},t),{"Content-Type":o}))],{type:o}),p=c(e.toString(),l),v={result:JSON.parse(JSON.stringify({beacon:p})),headers:t};return p?s(v):a(v)}));return(new s.FetchAsyncTransport).executeRpc(e,t,r,o)}executeBinaryRpc(e,t,r,n){return(new s.FetchAsyncTransport).executeBinaryRpc(e,t,r,n)}}})),define("metaserver/static/js/security/sjcl_crypto",["require","exports","tslib","sjcl"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRandomValues=void 0,n=r.__importStar(n),t.getRandomValues=function(e){const t=n.random.randomWords(e.length);for(let r=0,n=e.length,s=0<=n;s?r<n:r>n;s?r++:r--)e[r]=t[r];return e}})),define("metaserver/static/js/uuid/uuid",["require","exports","metaserver/static/js/uuid/insecure_uuid","metaserver/static/js/security/sjcl_crypto"],(function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UUID=void 0;const s=/generator isn't seeded/;class i extends r.InsecureUUID{static getRandomBytes(e={}){if("boolean"==typeof RUNNING_IN_REACTSERVER)return new Array(16).fill(0);const t=new Array(16);try{(0,n.getRandomValues)(t)}catch(r){if(r.message.match(s)&&e.allowInsecure)return this.getInsecureRandomValues(t);throw r}return t.map(e=>this.toByte(e))}static v4(e={}){const t=this.getRandomBytes({allowInsecure:e.allowInsecure});return t[6]=15&t[6]|64,t[8]=63&t[8]|128,this.bytesToUUIDString(t)}}t.UUID=i})),define("js/uuid/uuid",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UUID=void 0;const r=(()=>{let e,t;const r=[];for(e=0,t=e;e<=255;e++,t=e)r.push((t+256).toString(16).substr(1));return r})();function n(e){return e.map(e=>r[e]).join("")}t.UUID={getRandomBytes(){const e=new Uint8Array(16);return window.crypto&&window.crypto.getRandomValues(e),e},v4(){const e=this.getRandomBytes();e[6]=15&e[6]|64,e[8]=63&e[8]|128;const t=Array.prototype.slice.call(e);return[t.slice(0,4),t.slice(4,6),t.slice(6,8),t.slice(8,10),t.slice(10,16)].map(n).join("-")}}}));
//# sourceMappingURL=pkg-core-uuid.min.js-vflwJ-JHX.map